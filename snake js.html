<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Snake JS LAB1</title>
</head>
<body>
 
 <canvas id="canvas" width="400" height="400" style="padding-left: 560px; padding-top: 180px;"></canvas>
 <script src="https://code.jquery.com/jquery-2.1.0.js"></script>
 <script>
 
// Налаштування «полотна»
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
 
// Отримуємо ширину і висоту елемента canvas
var width = canvas.width;
var height = canvas.height;
 
// Обчислюємо ширину і висоту в осередках
var blockSize = 10;
var widthInBlocks = width / blockSize;
var heightInBlocks = height / blockSize;
 
//Встановлюємо рахунок 0
var score = 0;
 
// малюємо рамку
var drawBorder = function () {
  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, width, blockSize);
  ctx.fillRect(0, height - blockSize, width, blockSize);
  ctx.fillRect(0, 0, blockSize, height);
  ctx.fillRect(width - blockSize, 0, blockSize, height);
};
 
// Виводимо рахунок гри в лівому верхньому кутку
var drawScore = function () {
  ctx.font = "18px Courier";
  ctx.fillStyle = "Black";
  ctx.textAlign = "left";
  ctx.textBaseline = "top";
  ctx.fillText("Рахунок: " + score, blockSize, blockSize);
};
 
// Скасовуємо дію setInterval і друкуємо повідомлення «Кінець гри»
var gameOver = function () {
  clearInterval(intervalId);
  ctx.font = "60px Courier";
  ctx.fillStyle = "Black";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText("Кінець гри", width / 2, height / 2);
};
 
// малюємо коло
var circle = function (x, y, radius, fillCircle) {
  ctx.beginPath();
  ctx.arc(x, y, radius, 0, Math.PI * 2, false);
  if (fillCircle) {
    ctx.fill();
  } else {
    ctx.stroke();
  }
};
 
// Задаємо конструктор Block (осередок)
 var Block = function (col, row) {
  this.col = col;
  this.row = row;
};
 
// Малюємо квадрат в позиції комірки
Block.prototype.drawSquare = function (color) {
  var x = this.col * blockSize;
  var y = this.row * blockSize;
  ctx.fillStyle = color;
  ctx.fillRect(x, y, blockSize, blockSize);
};
 
// Малюємо коло в позиції комірки
Block.prototype.drawCircle = function (color) {
  var centerX = this.col * blockSize + blockSize / 2;
  var centerY = this.row * blockSize + blockSize / 2;
  ctx.fillStyle = color;
  circle(centerX, centerY, blockSize / 2, true);
};
 
// Перевіряємо, чи знаходиться ця комірка в тій же позиції, що і осередок
// otherBlock
Block.prototype.equal = function (otherBlock) {
  return this.col === otherBlock.col && this.row === otherBlock.row;
};
 
// Задаємо конструктор Snake (змійка)
var Snake = function () {
  this.segments = [
    new Block(7, 5),
    new Block(6, 5),
    new Block(5, 5)
  ];
 
  this.direction = "right";
  this.nextDirection = "right";
};
 
// Малюємо квадратик для кожного сегмента тіла змійки
Snake.prototype.draw = function () {
  for (var i = 0; i < this.segments.length; i++) {
    this.segments[i].drawSquare("red");
  }
};
 
// Створюємо нову голову і додаємо її до початку змійки,
// щоб пересунути змійку в поточному напрямі
Snake.prototype.move = function () {
  var head = this.segments[0];
  var newHead;
 
  this.direction = this.nextDirection;
 
  if (this.direction === "right") {
    newHead = new Block(head.col + 1, head.row);
  } else if (this.direction === "down") {
    newHead = new Block(head.col, head.row + 1);
  } else if (this.direction === "left") {
    newHead = new Block(head.col - 1, head.row);
  } else if (this.direction === "up") {
    newHead = new Block(head.col, head.row - 1);
  }
 
  if (this.checkCollision(newHead)) {
    gameOver();
    return;
  }
  this.segments.unshift(newHead);
  if (newHead.equal(apple.position)) {
    score++;
    apple.move();
  } else {
    this.segments.pop();
  }
};
 
// Перевіряємо, не зіткнулася чи змійка зі стіною або власним
// тілом
Snake.prototype.checkCollision = function (head) {
  var leftCollision = (head.col === 0);
  var topCollision = (head.row === 0);
  var rightCollision = (head.col === widthInBlocks - 1);
  var bottomCollision = (head.row === heightInBlocks - 1);
  var wallCollision = leftCollision || topCollision || rightCollision || bottomCollision;
 
  var selfCollision = false;
  
  for (var i = 0; i < this.segments.length; i++) {
    if (head.equal(this.segments[i])) {
      selfCollision = true;
    }
  }
 
  return wallCollision || selfCollision;
};
 
// Задаємо наступний напрямок руху змійки на основі натиснутою
// клавіші
Snake.prototype.setDirection = function (newDirection) {
  if (this.direction === "up" && newDirection === "down") {
    return;
  } else if (this.direction === "right" && newDirection === "left") {
    return;
  } else if (this.direction === "down" && newDirection === "up") {
    return;
  } else if (this.direction === "left" && newDirection === "right") {
    return;
  }
 
  this.nextDirection = newDirection;
};
 
// Задаємо конструктор Apple (яблуко)
var Apple = function () {
  this.position = new Block(10, 10);
};
 
// Малюємо гурток в позиції яблука
Apple.prototype.draw = function () {
  this.position.drawCircle("LimeGreen");
};
 
// Переміщаємо яблуко в випадкову позицію
Apple.prototype.move = function () {
 var randomCol = Math.floor(Math.random() * (widthInBlocks - 2)) + 1;
 var randomRow = Math.floor(Math.random() * (heightInBlocks - 2)) + 1;
  this.position = new Block(randomCol, randomRow);
};
 
// Створюємо об'єкт-змійку і об'єкт-яблуко
var snake = new Snake();
var apple = new Apple();
 
// Запускаємо функцію анімації через setInterval
var intervalId = setInterval(function () {
  ctx.clearRect(0, 0, width, height);
  drawScore();
  snake.move();
  snake.draw();
  apple.draw();
  drawBorder();
}, 100);
 
// Перетворимо коди клавіш в напрямку
var directions = {
  37: "left",
  38: "up",
  39: "right",
  40: "down"
};
 
// Задаємо обробник події keydown (клавіші-стрілки)
$("body").keydown(function (event) {
  var newDirection = directions[event.keyCode];
  if (newDirection !== undefined) {
    snake.setDirection(newDirection);
  }
});
 
 
  </script> 

    
</body>
</html>